<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Archive List</title>
    <link href="./archive_style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <div class="wrapper">
        <div class="sidebar">
            <a href="index.html"><img src="./logo.png"></a>
            <ul>
                <li><a href="login.html"><i class="fa fa-shield"></i> Sign Out</a></li>
                <li><a href="contactus.html"><i class="fa fa-phone"></i> Contact Us</a></li>
                <li><a href="about.html"><i class="fa fa-exclamation-circle"></i> About Us</a></li>
            </ul>
        </div>
        <div class="content-area">
            <div class="archive-header">
                <input type="text" id="searchInput" placeholder="&nbsp;&nbsp;&#xf002; &nbsp;Search... ">    
                <button class="add" onclick="togglePopup()">Add</button>
                <button class="remove" onclick="togglePopup2()">Remove</button>
                <button class="edit">Edit</button>
            </div>
            <div class="items">
            </div>
        </div>
        <div class="popup-upload">
            <div class="login-box">
                <center><h2 class="h2-10"><br>Upload Unit<br><br></h2>
                    <form onsubmit="addNewEntry(); return false;">
                    <div class="input-container">
                        <input type="text" id="unitname" placeholder="&#xf0f6; Unit Name" class="text-field" autocomplete="off" required>
                    </div>

                    <div class="input-container">

                        <input type="date" id="date-of-purchase" placeholder="&#xF007; Date of Storage" class="text-field" autocomplete="off" required> 
                    </div>
                    <div class="input-container">
                        
                        <input type="text" id="category" placeholder="&#xF187; Item Description" class="text-field" autocomplete="off" required> 
                    </div>
                    <div class="input-container">
                       
                        <input type="text" id="condition" placeholder="&#xf16b; Condition" class="text-field" autocomplete="off" required>
                    </div>
                    <div class="input-container">
                        <input type="file" id="unit-image" name="unit-image" accept="image/jpeg, image/png, image/jpg" style="display:none;" autocomplete="off" required>
                        <label for="unit-image" id="file-label">Upload Image</label>
                    </div>
                    <button type="submit" class="action-confirm" style="width: 200px; margin-top: 30px;">Upload File</button>
                </form>
                </center>
            </div>
        </div>
    
        <div class="popup-delete">
            <div class="login-box2">
                <center>
                    <h2 class="h2-10"><br>Delete Item<br><br></h2>
                    <p>Which it do you want to delete?</p><br>
                    <select id="deleteItemSelect"></select><br><br>
                    <button class="action-confirm" onclick="deleteItem()">Delete</button>
                    <button class="action-confirm" onclick="cancelDelete()">Cancel</button>
                </center>
            </div>
        </div>

    <script>

        let isPopupVisible = false;

        //function to toggle the popup visibility
        function togglePopup() {
            const popup = document.querySelector('.popup-upload');
            isPopupVisible = !isPopupVisible;
            popup.style.display = isPopupVisible ? 'block' : 'none';
        }

        //function to close the popup if clicked outside
        window.onclick = function (event) {
            const popup = document.querySelector('.popup-upload');
            if (event.target === popup) {
                popup.style.display = 'none';
                isPopupVisible = false;
            }
        };

        const searchInput = document.querySelector('#searchInput');
        const items = document.querySelectorAll('.image-container');
    
        searchInput.addEventListener('input', function (event) {
            const searchTerm = event.target.value.toLowerCase();
    
            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                const name = item.getAttribute('data-name').toLowerCase();
                name.includes(searchTerm) && (item.style.display = 'block') || (item.style.display = 'none');
            }
        });

        //changes the image input label to the file name
        const fileInput = document.getElementById('unit-image');
        const fileLabel = document.getElementById('file-label');

        fileInput.addEventListener('change', (event) => {
            const fileName = event.target.files[0].name;
            fileLabel.textContent = fileName;
        });

        const uploadButton = document.querySelector('.action-confirm');
        uploadButton.style.display = 'none';

        //when all 5 entries are filled the submit button appears
        function checkInputs() {
            const unitname = document.getElementById('unitname').value;
            const category = document.getElementById('category').value;
            const condition = document.getElementById('condition').value;
            const date = document.getElementById('date-of-purchase').value;
            const image = document.getElementById('unit-image').value;

            if (unitname && category && condition && date && image) {
                uploadButton.style.display = 'block';
            } else {
                uploadButton.style.display = 'none';
            }
        }

        //adds input event listeners to all input fields
        document.getElementById('unitname').addEventListener('input', checkInputs);
        document.getElementById('category').addEventListener('input', checkInputs);
        document.getElementById('condition').addEventListener('input', checkInputs);
        document.getElementById('date-of-purchase').addEventListener('input', checkInputs);
        document.getElementById('unit-image').addEventListener('input', checkInputs);

        //adds entry
        function addEntry(name, description, condition, date, image) {
            const formattedDate = new Date(date).toLocaleDateString('en-GB');

            const newItem = document.createElement('div');
            newItem.classList.add('image-container');
            newItem.setAttribute('data-name', name);
            newItem.innerHTML = `
                <img src="${image}" class="image">
                <div class="overlay">
                    <p class="item-num"><br>${name}</p>
                    <h2 class="item-description"><br><br><br>Condition: ${condition}<br><br>Item Description: ${description}<br><br>Date of Storage: ${date}</h2>
                </div>
            `;
            //appends to container div
            document.querySelector('.items').appendChild(newItem);
        }

        function addNewEntry() {
            //get form values
            const name = document.getElementById('unitname').value;
            const description = document.getElementById('category').value;
            const condition = document.getElementById('condition').value;
            const date = document.getElementById('date-of-purchase').value;
            const image = URL.createObjectURL(document.getElementById('unit-image').files[0]);
            
            //add the new entry
            addEntry(name, description, condition, date, image);

            //clear form inputs
            document.getElementById('unitname').value = '';
            document.getElementById('category').value = '';
            document.getElementById('condition').value = '';
            document.getElementById('date-of-purchase').value = '';

            const fileInput = document.getElementById('unit-image');
            fileInput.value = '';
            document.getElementById('file-label').textContent = 'Upload Image'; 

            //needed resets
            uploadButton.style.display = 'none';
            isPopupVisible = false;
            document.querySelector('.popup-upload').style.display = 'none';
        }
    </script>
    
    <script>
        let isDeletePopupVisible = false;
        let itemToDelete;

        // Function to toggle the delete popup visibility
        function togglePopup2() {
            const deletePopup = document.querySelector('.popup-delete');
            isDeletePopupVisible = !isDeletePopupVisible;
            deletePopup.style.display = isDeletePopupVisible ? 'block' : 'none';

            // Populate the dropdown with item names when the popup is visible
            if (isDeletePopupVisible) {
                populateDeleteDropdown();
            }
        }

        // Function to populate the delete dropdown with item names
        function populateDeleteDropdown() {
            const deleteItemSelect = document.getElementById('deleteItemSelect');
            deleteItemSelect.innerHTML = ''; // Clear existing options

            // Get all item containers and add them as options in the dropdown
            const itemContainers = document.querySelectorAll('.image-container');
            for (const container of itemContainers) {
                const itemName = container.getAttribute('data-name');
                const option = document.createElement('option');
                option.value = itemName;
                option.textContent = itemName;
                deleteItemSelect.appendChild(option);
            }
        }

        // Function to set the item to delete and show the delete popup
        function showDeletePopup(itemName) {
            itemToDelete = itemName;
            togglePopup2();
        }

        // Function to cancel delete and hide the delete popup
        function cancelDelete() {
            togglePopup2();
        }

        // Function to delete the item and remove it from the list
        function deleteItem() {
            // Replace this part with backend logic to delete the item from the database

            // For demonstration purposes, we'll remove the item from the list on the client-side
            const itemContainers = document.querySelectorAll('.image-container');
            for (const container of itemContainers) {
                const name = container.getAttribute('data-name').toLowerCase();
                if (name === itemToDelete) {
                    container.remove();
                    break;
                }
            }

            // Remove the item from the dropdown as well
            const deleteItemSelect = document.getElementById('deleteItemSelect');
            const selectedOption = deleteItemSelect.querySelector(`option[value="${itemToDelete}"]`);
            if (selectedOption) {
                selectedOption.remove();
            }

            // Hide the delete popup
            togglePopup2();
        }
    </script>
    </div>
</body>

</html>